// paste during CI pipeline creation process in script section (windows os)

pipeline {
  agent any
  stages {
    stage('Clone repository') {
      steps {
        git 'https://github.com/arjun10015/python-demoapp.git'
      }
    }
    stage('Install dependencies') {
      steps {
        bat 'pip install -r requirements.txt'
      }
    }
    stage('Run Python Tests') {
      steps {
        bat 'pytest || exit 0'
      }
    }
    stage('Build Docker Image') {
      steps {
        bat 'docker build -t arjun10015/python-demoapp:latest .'
      }
    }
  }
}


// paste during CD pipeline creation process in script section (windows os)

pipeline {
  agent any
  stages {
    stage('Deploy Docker') {
      steps {
        bat 'docker pull arjun10015/python-demoapp:latest'
        bat 'docker stop python-demoapp || exit 0'
        bat 'docker rm python-demoapp || exit 0'
        bat 'docker run -d --name python-demoapp -p 5000:5000 arjun10015/python-demoapp:latest'
      }
    }
  }
}

//ansible

nano playbook01.yml

- hosts: localhost
 tasks:
 - name: Print message
  debug:
   msg: Hello Ansible World

ansible-playbook -i inventory playbook-01.yml -u sammy

//ansible.app

sudo apt update
sudo apt install -y ansible
ansible --version

mkdir ~/ansible-lab8
cd ~/ansible-lab8

ansible-galaxy init prerequisites
ansible-galaxy init postgresql
ansible-galaxy init apache

/prerequisites/tasks/

sudo vim main.yml

- name: Update apt and install git
  become: true
  apt:
    name: git
    state: present
    update_cache: yes

shift+esc+; and press wq to save

/postgresql/tasks/

sudo vim main.yml

- name: Install PostgreSQL
  become: true
  apt:
    name: postgresql
    state: present
    update_cache: yes

shift+esc+; and press wq to save

/apache/tasks/

sudo vim main.yml

- name: Install Apache2
  become: true
  apt:
    name: apache2
    state: present
    update_cache: yes

shift+esc+; and press wq to save

nano stack.yml (~/ansible-lab8) 

- hosts: localhost
  become: true
  connection: local
  roles:
    - prerequisites
    - postgresql
    - apache

ansible-playbook stack.yml
