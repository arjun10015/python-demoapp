// copy paste during CI pipeline creation process in script section for ex4 (windows os)
// if required change user id based on ur docker credentials

pipeline {
  agent any
  stages {
    stage('Clone repository') {
      steps {
        git 'https://github.com/arjun10015/python-demoapp.git'
      }
    }
    stage('Install dependencies') {
      steps {
        bat 'pip install -r requirements.txt'
      }
    }
    stage('Run Python Tests') {
      steps {
        bat 'pytest || exit 0'
      }
    }
    stage('Build Docker Image') {
      steps {
        bat 'docker build -t arjun10015/python-demoapp:latest .'
      }
    }
  }
}


// copy paste during CD pipeline creation process in script section for ex5 (windows os)
// if required change user id based on ur docker credentials

pipeline {
  agent any
  stages {
    stage('Deploy Docker') {
      steps {
        bat 'docker pull arjun10015/python-demoapp:latest'
        bat 'docker stop python-demoapp || exit 0'
        bat 'docker rm python-demoapp || exit 0'
        bat 'docker run -d --name python-demoapp -p 5000:5000 arjun10015/python-demoapp:latest'
      }
    }
  }
}
